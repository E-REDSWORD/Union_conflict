<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#14142a">
  <title>Ù„Ø¹Ø¨Ø© ØµØ±Ø§Ø¹ Ø§Ù„Ù†Ù‚Ø§Ø¨Ø§Øª - Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠ</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #ffbb33;
      --secondary: #6c5ce7;
      --dark: #1e1e2f;
      --darker: #14142a;
      --medium: #2c2c44;
      --light: #f7f7ff;
      --success: #00b894;
      --danger: #ff6b6b;
      --info: #54a0ff;
      --warning: #feca57;
      --card-bg: rgba(44, 44, 68, 0.85);
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    body {
      direction: rtl;
      background: linear-gradient(135deg, var(--darker), var(--dark));
      background-attachment: fixed;
      color: var(--light);
      min-height: 100vh;
      padding: 10px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 16px;
      line-height: 1.6;
    }
    
    .game-container {
      width: 100%;
      max-width: 100%;
      background: var(--card-bg);
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.6);
      border: 1px solid rgba(255, 255, 255, 0.15);
      margin: 10px;
    }
    
    .header {
      background: linear-gradient(90deg, var(--darker), var(--dark));
      padding: 20px 15px;
      text-align: center;
      border-bottom: 3px solid var(--primary);
      position: relative;
      overflow: hidden;
    }
    
    .header::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 5px;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
    }
    
    h1 {
      font-size: 1.8rem;
      margin-bottom: 8px;
      color: var(--primary);
      text-shadow: 0 2px 8px rgba(0, 0, 0, 0.7);
      position: relative;
      display: inline-block;
      padding: 0 10px;
    }
    
    h1::after {
      content: "";
      position: absolute;
      bottom: -8px;
      left: 25%;
      right: 25%;
      height: 3px;
      background: var(--secondary);
      border-radius: 3px;
    }
    
    h2 {
      font-size: 1.5rem;
      margin: 20px 0 15px;
      color: var(--warning);
      padding-bottom: 10px;
      border-bottom: 2px solid var(--secondary);
      position: relative;
    }
    
    h2::after {
      content: "";
      position: absolute;
      bottom: -2px;
      left: 30%;
      right: 30%;
      height: 2px;
      background: var(--primary);
    }
    
    h3 {
      font-size: 1.2rem;
      margin: 15px 0 10px;
      color: var(--primary);
    }
    
    .content {
      padding: 15px;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    
    .section {
      background: rgba(35, 35, 55, 0.7);
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
      border: 1px solid rgba(255, 255, 255, 0.12);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    
    .section:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 25px rgba(0, 0, 0, 0.5);
    }
    
    .flex-row {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    
    .flex-col {
      width: 100%;
    }
    
    .guild-card {
      background: rgba(50, 50, 80, 0.9);
      border-radius: 12px;
      padding: 15px;
      margin-bottom: 15px;
      border-left: 5px solid var(--primary);
      box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
      position: relative;
      transition: all 0.3s ease;
    }
    
    .guild-card:hover {
      transform: translateX(-5px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
    }
    
    .guild-card h4 {
      color: var(--primary);
      margin-bottom: 10px;
      font-size: 1.2rem;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: var(--light);
      font-size: 1rem;
    }
    
    input[type="text"],
    input[type="number"],
    select {
      width: 100%;
      padding: 15px;
      margin-bottom: 15px;
      border-radius: 12px;
      border: 2px solid rgba(255, 255, 255, 0.2);
      background: rgba(25, 25, 40, 0.8);
      color: var(--light);
      font-size: 1.05rem;
      transition: all 0.3s;
      height: 55px;
    }
    
    input:focus, select:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 4px rgba(255, 187, 51, 0.4);
    }
    
    .btn-group {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-top: 15px;
    }
    
    button {
      padding: 16px 25px;
      border-radius: 12px;
      border: none;
      font-size: 1.1rem;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      box-shadow: 0 6px 15px rgba(0, 0, 0, 0.4);
      min-height: 55px;
      user-select: none;
      width: 100%;
      position: relative;
      overflow: hidden;
    }
    
    button::after {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255, 255, 255, 0.1);
      transform: translateX(-100%);
      transition: transform 0.3s;
    }
    
    button:hover::after {
      transform: translateX(0);
    }
    
    button i {
      font-size: 1.2rem;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, var(--primary), #ffaa00);
      color: var(--darker);
    }
    
    .btn-primary:active {
      transform: translateY(3px);
      box-shadow: 0 3px 10px rgba(255, 187, 51, 0.5);
    }
    
    .btn-primary:disabled {
      background: linear-gradient(135deg, #666, #999);
      cursor: not-allowed;
      opacity: 0.7;
    }
    
    .btn-secondary {
      background: linear-gradient(135deg, var(--secondary), #5d4fe0);
      color: var(--light);
    }
    
    .btn-secondary:active {
      transform: translateY(3px);
    }
    
    .btn-danger {
      background: linear-gradient(135deg, var(--danger), #ff5252);
      color: var(--light);
    }
    
    .btn-danger:active {
      transform: translateY(3px);
    }
    
    .btn-success {
      background: linear-gradient(135deg, var(--success), #00a884);
      color: var(--light);
    }
    
    .btn-success:active {
      transform: translateY(3px);
    }
    
    .btn-warning {
      background: linear-gradient(135deg, var(--warning), #ff9f43);
      color: var(--darker);
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 15px 0;
      background: rgba(35, 35, 55, 0.6);
      border-radius: 12px;
      overflow: hidden;
      display: block;
      overflow-x: auto;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }
    
    th {
      background: linear-gradient(to right, var(--darker), var(--secondary));
      padding: 15px;
      text-align: center;
      font-weight: 700;
      font-size: 1rem;
      white-space: nowrap;
    }
    
    td {
      padding: 15px;
      text-align: center;
      border-bottom: 1px solid rgba(255, 255, 255, 0.15);
      font-size: 0.95rem;
      white-space: nowrap;
    }
    
    tr:last-child td {
      border-bottom: none;
    }
    
    .actions {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    
    .action-select {
      min-width: 100%;
      background: rgba(30, 30, 50, 0.8);
      border: 2px solid rgba(255, 255, 255, 0.2);
      color: var(--light);
      padding: 12px;
      border-radius: 10px;
      font-size: 1rem;
      height: 55px;
    }
    
    .target-select {
      min-width: 100%;
      background: rgba(50, 30, 40, 0.8);
      border: 2px solid var(--danger);
      color: var(--light);
      padding: 12px;
      border-radius: 10px;
      font-size: 1rem;
      height: 55px;
    }
    
    .round-summary {
      background: rgba(30, 30, 50, 0.9);
      padding: 20px;
      border-radius: 12px;
      margin-top: 20px;
      border-left: 5px solid var(--info);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }
    
    .summary-title {
      color: var(--info);
      font-size: 1.2rem;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .summary-content {
      line-height: 1.7;
      font-size: 1rem;
    }
    
    .summary-content ul {
      padding-right: 20px;
    }
    
    .summary-content li {
      margin-bottom: 10px;
      padding-right: 10px;
      border-right: 3px solid var(--secondary);
    }
    
    .event-card {
      background: rgba(80, 50, 100, 0.8);
      border-radius: 10px;
      padding: 15px;
      margin-top: 15px;
      border: 2px solid var(--secondary);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }
    
    .event-title {
      color: var(--warning);
      font-weight: bold;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 1.1rem;
    }
    
    .points {
      font-weight: bold;
      font-size: 1.1rem;
      padding: 2px 8px;
      border-radius: 5px;
      display: inline-block;
    }
    
    .points.positive {
      background: rgba(0, 184, 148, 0.2);
      color: var(--success);
    }
    
    .points.negative {
      background: rgba(255, 107, 107, 0.2);
      color: var(--danger);
    }
    
    .winner-badge {
      background: var(--success);
      color: white;
      padding: 3px 10px;
      border-radius: 20px;
      font-size: 0.8rem;
      margin-right: 8px;
      box-shadow: 0 3px 8px rgba(0, 0, 0, 0.3);
    }
    
    .footer {
      text-align: center;
      padding: 20px;
      color: rgba(255, 255, 255, 0.7);
      font-size: 0.9rem;
      border-top: 1px solid rgba(255, 255, 255, 0.15);
      background: rgba(20, 20, 40, 0.7);
    }
    
    .hidden {
      display: none;
    }
    
    .guild-badge {
      display: inline-block;
      width: 25px;
      height: 25px;
      border-radius: 50%;
      margin-left: 8px;
      box-shadow: 0 3px 8px rgba(0, 0, 0, 0.3);
    }
    
    .guild-1 { background: linear-gradient(135deg, #ff9a9e, #fad0c4); }
    .guild-2 { background: linear-gradient(135deg, #a1c4fd, #c2e9fb); }
    .guild-3 { background: linear-gradient(135deg, #ffecd2, #fcb69f); }
    .guild-4 { background: linear-gradient(135deg, #84fab0, #8fd3f4); }
    .guild-5 { background: linear-gradient(135deg, #d4fc79, #96e6a1); }
    
    .status-bar {
      display: flex;
      justify-content: space-between;
      padding: 15px;
      background: rgba(30, 30, 50, 0.6);
      border-radius: 12px;
      margin-bottom: 20px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }
    
    .status-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      flex: 1;
      padding: 10px;
      border-radius: 10px;
      background: rgba(40, 40, 60, 0.5);
    }
    
    .status-value {
      font-size: 1.4rem;
      font-weight: bold;
      color: var(--primary);
      margin-bottom: 5px;
    }
    
    .status-label {
      font-size: 0.9rem;
      color: rgba(255, 255, 255, 0.8);
    }
    
    .strategy-hint {
      background: rgba(80, 50, 100, 0.6);
      border-radius: 10px;
      padding: 15px;
      margin-top: 15px;
      border-left: 4px solid var(--warning);
      font-size: 1rem;
    }
    
    .validation-error {
      color: var(--danger);
      font-size: 0.9rem;
      margin-top: -10px;
      margin-bottom: 10px;
      display: none;
      font-weight: 600;
    }
    
    .guilds-selector {
      background: rgba(50, 50, 80, 0.9);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      border-left: 5px solid var(--info);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }
    
    .start-btn-fixed {
      position: sticky;
      bottom: 20px;
      z-index: 100;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.7);
    }
    
    .timer-container {
      background: rgba(40, 40, 60, 0.8);
      border-radius: 15px;
      padding: 20px;
      margin: 20px 0;
      text-align: center;
      border: 2px solid var(--warning);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
    }
    
    #timer-display {
      font-size: 3.5rem;
      font-weight: bold;
      margin: 15px 0;
      color: var(--warning);
      font-family: monospace;
      text-shadow: 0 0 10px rgba(254, 202, 87, 0.5);
    }
    
    .timer-controls {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    
    .timer-controls button {
      width: 100%;
    }
    
    .display-view {
      background: rgba(20, 20, 40, 0.95);
      border-radius: 15px;
      padding: 25px;
      margin-top: 25px;
      border: 3px solid var(--info);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
    }
    
    .guilds-display {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin: 25px 0;
      justify-content: center;
    }
    
    .guild-display-card {
      background: rgba(60, 60, 100, 0.9);
      border-radius: 12px;
      padding: 20px;
      min-width: 160px;
      text-align: center;
      border-left: 5px solid var(--primary);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
      transition: transform 0.3s;
    }
    
    .guild-display-card:hover {
      transform: translateY(-5px);
    }
    
    .guild-display-name {
      font-weight: bold;
      font-size: 1.2rem;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    .guild-display-points {
      font-size: 2rem;
      font-weight: bold;
      color: var(--primary);
      margin: 10px 0;
      text-shadow: 0 0 8px rgba(255, 187, 51, 0.4);
    }
    
    .announcement-bar {
      background: rgba(255, 187, 51, 0.25);
      border: 2px solid var(--warning);
      border-radius: 12px;
      padding: 15px;
      margin: 20px 0;
      text-align: center;
      font-weight: bold;
      font-size: 1.1rem;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }
    
    .stats-card {
      background: rgba(50, 50, 80, 0.9);
      border-radius: 12px;
      padding: 20px;
      margin: 20px 0;
      border-left: 5px solid var(--info);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
      margin-top: 15px;
    }
    
    .stat-item {
      background: rgba(40, 40, 60, 0.7);
      padding: 15px;
      border-radius: 10px;
      text-align: center;
    }
    
    .stat-value {
      font-size: 1.4rem;
      font-weight: bold;
      color: var(--primary);
      margin: 8px 0;
    }
    
    .stat-label {
      font-size: 0.95rem;
      color: rgba(255, 255, 255, 0.8);
    }
    
    .save-load-container {
      display: flex;
      flex-direction: column;
      gap: 15px;
      margin-top: 20px;
    }
    
    .floating-controls {
      position: fixed;
      bottom: 20px;
      right: 20px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      z-index: 200;
    }
    
    .floating-btn {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.5);
      font-size: 1.5rem;
    }
    
    @media (min-width: 768px) {
      .flex-row {
        flex-direction: row;
      }
      
      .flex-col {
        flex: 1;
        min-width: 300px;
      }
      
      .btn-group {
        flex-direction: row;
      }
      
      .timer-controls {
        flex-direction: row;
      }
      
      .actions {
        flex-direction: row;
      }
      
      .action-select, .target-select {
        min-width: 180px;
      }
      
      .save-load-container {
        flex-direction: row;
      }
    }
    
    @media (max-width: 480px) {
      h1 {
        font-size: 1.6rem;
      }
      
      h2 {
        font-size: 1.3rem;
      }
      
      .guild-card, .section {
        padding: 15px;
      }
      
      button {
        padding: 14px 18px;
        font-size: 1rem;
      }
      
      .status-bar {
        flex-direction: column;
        gap: 12px;
      }
      
      .timer-controls button {
        width: 100%;
      }
      
      .guild-display-card {
        min-width: 130px;
        padding: 15px;
      }
      
      #timer-display {
        font-size: 2.8rem;
      }
    }
    
    /* Animations */
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
    
    .pulse {
      animation: pulse 1.5s infinite;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .fade-in {
      animation: fadeIn 0.5s ease-out;
    }
    
    /* Scrollbar styling */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    
    ::-webkit-scrollbar-track {
      background: rgba(30, 30, 50, 0.5);
      border-radius: 10px;
    }
    
    ::-webkit-scrollbar-thumb {
      background: var(--secondary);
      border-radius: 10px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: var(--primary);
    }
  </style>
</head>
<body>
  <div class="game-container fade-in">
    <div class="header">
    	<h1><i class="fa-solid fa-chess-queen"></i>ğ–¤ | ğ‘ğ„ğƒğ’ğ–ğğ‘ğƒ & ÙØ±ÙŠÙ‚ Ø§Ù„ØªØ·ÙˆÙŠØ±</h2>
      <ul>
        <li><strong>ğ–¤ | ğ‘ğ„ğƒğ’ğ–ğğ‘ğƒ</strong> â€“ Ù‚Ø§Ø¦Ø¯ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹_Ø¨Ø±Ù…Ø¬Ø©</li></h1>
      <h2><i class="fa-solid fa-chess-queen"></i> Ù„Ø¹Ø¨Ø© ØµØ±Ø§Ø¹ Ø§Ù„Ù†Ù‚Ø§Ø¨Ø§Øª - Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠ</h2>
      <p>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¶ÙŠÙ - ØªØ­ÙƒÙ… ÙƒØ§Ù…Ù„ ÙÙŠ Ø³ÙŠØ± Ø§Ù„Ù„Ø¹Ø¨Ø© ÙˆØªØ·ÙˆØ± Ø§Ù„Ø£Ø­Ø¯Ø§Ø«</p>
    </div>
    
    <div class="content">
      <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ -->
      <section id="setup-section" class="section">
        <h2><i class="fa-solid fa-cog"></i> Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù†Ù‚Ø§Ø¨Ø§Øª ÙˆØ§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†</h2>
        <p>Ø§Ø®ØªØ± Ø¹Ø¯Ø¯ Ø§Ù„Ù†Ù‚Ø§Ø¨Ø§Øª Ø«Ù… Ø£Ø¯Ø®Ù„ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù†Ù‚Ø§Ø¨Ø§Øª ÙˆØ¹Ø¯Ø¯ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† ÙÙŠ ÙƒÙ„ Ù†Ù‚Ø§Ø¨Ø©.</p>
        
        <div class="guilds-selector">
          <label>Ø¹Ø¯Ø¯ Ø§Ù„Ù†Ù‚Ø§Ø¨Ø§Øª:</label>
          <select id="guilds-count" class="guilds-count">
            <option value="">-- Ø§Ø®ØªØ± Ø¹Ø¯Ø¯ Ø§Ù„Ù†Ù‚Ø§Ø¨Ø§Øª --</option>
            <option value="2">2 Ù†Ù‚Ø§Ø¨Ø§Øª</option>
            <option value="3">3 Ù†Ù‚Ø§Ø¨Ø§Øª</option>
            <option value="4">4 Ù†Ù‚Ø§Ø¨Ø§Øª</option>
            <option value="5">5 Ù†Ù‚Ø§Ø¨Ø§Øª</option>
          </select>
        </div>
        
        <div id="guilds-inputs" class="flex-col">
          <!-- Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ù‡Ù†Ø§ Ø¨Ø´ÙƒÙ„ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠ -->
        </div>
        
        <div class="btn-group">
          <button id="start-game-btn" class="btn-primary start-btn-fixed" disabled>
            <i class="fa-solid fa-play"></i> Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©
          </button>
        </div>
        
        <div class="save-load-container">
          <button id="save-game-btn" class="btn-secondary">
            <i class="fa-solid fa-save"></i> Ø­ÙØ¸ Ø§Ù„Ù„Ø¹Ø¨Ø©
          </button>
          <button id="load-game-btn" class="btn-info">
            <i class="fa-solid fa-folder-open"></i> Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
          </button>
        </div>
      </section>
      
      <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© -->
      <section id="game-section" class="section hidden">
        <div class="flex-row">
          <div class="flex-col">
            <div class="status-bar">
              <div class="status-item">
                <div class="status-value" id="round-number">1</div>
                <div class="status-label">Ø§Ù„Ø¬ÙˆÙ„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</div>
              </div>
              <div class="status-item">
                <div class="status-value" id="total-guilds">0</div>
                <div class="status-label">Ø¹Ø¯Ø¯ Ø§Ù„Ù†Ù‚Ø§Ø¨Ø§Øª</div>
              </div>
              <div class="status-item">
                <div class="status-value" id="total-players">0</div>
                <div class="status-label">Ø¹Ø¯Ø¯ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†</div>
              </div>
            </div>
            
            <div class="guild-card">
              <h4><i class="fa-solid fa-lightbulb"></i> ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ø¬ÙˆÙ„Ø©</h4>
              <p>ÙŠØ¬Ø¨ Ø¹Ù„Ù‰ ÙƒÙ„ Ù†Ù‚Ø§Ø¨Ø© Ø§Ø®ØªÙŠØ§Ø± Ù‚Ø±Ø§Ø±Ù‡Ø§ Ù„Ù‡Ø°Ù‡ Ø§Ù„Ø¬ÙˆÙ„Ø©. Ø¨Ø¹Ø¯ Ø§Ø®ØªÙŠØ§Ø± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù‚Ø±Ø§Ø±Ø§ØªØŒ Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ "ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù‚Ø±Ø§Ø±Ø§Øª" Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†ØªØ§Ø¦Ø¬.</p>
              <div class="strategy-hint">
                <strong>Ù†ØµØ§Ø¦Ø­ Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ©:</strong> Ù‚Ø±Ø§Ø±Ø§ØªÙƒ ØªØ¤Ø«Ø± Ø¹Ù„Ù‰ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø¨Ø´ÙƒÙ„ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø¹Ø¯Ø¯ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†ØŒ Ù‚Ø±Ø§Ø±Ø§Øª Ø§Ù„Ù†Ù‚Ø§Ø¨Ø§Øª Ø§Ù„Ø£Ø®Ø±Ù‰ØŒ ÙˆØ¹ÙˆØ§Ù…Ù„ Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©.
              </div>
            </div>
            
            <!-- Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø¤Ù‚Øª -->
            <div class="timer-container">
              <h3><i class="fas fa-clock"></i> Ù…Ø¤Ù‚Øª Ø§Ù„Ø¬ÙˆÙ„Ø©</h3>
              <div id="timer-display">02:00</div>
              <div class="timer-controls">
                <button id="start-timer" class="btn-warning">
                  <i class="fas fa-play"></i> Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø¤Ù‚Øª
                </button>
                <button id="pause-timer" class="btn-secondary">
                  <i class="fas fa-pause"></i> Ø¥ÙŠÙ‚Ø§Ù
                </button>
                <button id="reset-timer" class="btn-danger">
                  <i class="fas fa-redo"></i> Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†
                </button>
              </div>
            </div>
            
            <div style="overflow-x: auto;">
              <table>
                <thead>
                  <tr>
                    <th>Ø§Ù„Ù†Ù‚Ø§Ø¨Ø©</th>
                    <th>Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†</th>
                    <th>Ø§Ù„Ù†Ù‚Ø§Ø·</th>
                    <th>Ø§Ù„Ù‚Ø±Ø§Ø±</th>
                    <th>Ø§Ù„Ù‡Ø¯Ù (Ù„Ù„Ø£Ù‡Ù€Ù€Ø¯Ø§Ù)</th>
                  </tr>
                </thead>
                <tbody id="guilds-table-body"></tbody>
              </table>
            </div>
            
            <div class="btn-group">
              <button id="submit-decisions-btn" class="btn-primary">
                <i class="fa-solid fa-calculator"></i> ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù‚Ø±Ø§Ø±Ø§Øª ÙˆØ­Ø³Ø§Ø¨ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
              </button>
              <button id="reset-game-btn" class="btn-danger">
                <i class="fa-solid fa-rotate-left"></i> Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù„Ø¹Ø¨Ø©
              </button>
            </div>
          </div>
          
          <div class="flex-col">
            <h2>Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¬ÙˆÙ„Ø©</h2>
            <div class="round-summary">
              <div class="summary-title">
                <i class="fa-solid fa-file-lines"></i>
                Ù…Ù„Ø®Øµ Ø§Ù„Ø¬ÙˆÙ„Ø© <span id="current-round">1</span>
              </div>
              <div class="summary-content" id="round-summary">
                <p>ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù‚Ø±Ø§Ø±Ø§Øª Ø§Ù„Ù†Ù‚Ø§Ø¨Ø§Øª ÙˆØ§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ "ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù‚Ø±Ø§Ø±Ø§Øª" Ù„Ø±Ø¤ÙŠØ© Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¬ÙˆÙ„Ø©.</p>
              </div>
              
              <div id="random-event" class="hidden">
                <div class="event-card">
                  <div class="event-title">
                    <i class="fa-solid fa-bolt"></i>
                    Ø­Ø¯Ø« Ù…ÙØ§Ø¬Ø¦!
                  </div>
                  <div id="event-description"></div>
                </div>
              </div>
            </div>
            
            <div class="btn-group">
              <button id="next-round-btn" class="btn-success hidden">
                <i class="fa-solid fa-forward"></i> Ø¬ÙˆÙ„Ø© Ø¬Ø¯ÙŠØ¯Ø©
              </button>
              <button id="filter-scores-btn" class="btn-secondary">
                <i class="fa-solid fa-filter"></i> ØªØµÙÙŠØ© Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø³Ù„Ø¨ÙŠØ©
              </button>
            </div>
            
            <h3>Ù†Ù‚Ø§Ø· Ø§Ù„Ù†Ù‚Ø§Ø¨Ø§Øª</h3>
            <div style="overflow-x: auto;">
              <table>
                <thead>
                  <tr>
                    <th>Ø§Ù„Ù†Ù‚Ø§Ø¨Ø©</th>
                    <th>Ø§Ù„Ù†Ù‚Ø§Ø·</th>
                    <th>Ø§Ù„ØªØºÙŠÙŠØ±</th>
                    <th>Ø¢Ø®Ø± Ù‚Ø±Ø§Ø±</th>
                  </tr>
                </thead>
                <tbody id="scores-table-body"></tbody>
              </table>
            </div>
            
            <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù†Ù‚Ø§Ø¨Ø§Øª -->
            <div class="stats-card">
              <h3><i class="fa-solid fa-chart-line"></i> Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù†Ù‚Ø§Ø¨Ø§Øª</h3>
              <div id="guild-stats" class="stats-grid">
                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠÙ‹Ø§ -->
              </div>
            </div>
            
            <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¨Ø³Ø·Ø© Ù„Ù„Ù…Ø´Ø§Ø±ÙƒØ© -->
            <div id="display-view" class="display-view">
              <h2><i class="fas fa-share-alt"></i> Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©</h2>
              <div class="announcement-bar" id="announcement">
                Ø¬Ø§Ù‡Ø² Ù„Ø¹Ø±Ø¶ Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© Ù„Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ†
              </div>
              <div class="display-content">
                <div class="round-info" style="font-size: 1.2rem; margin-bottom: 15px;">Ø§Ù„Ø¬ÙˆÙ„Ø©: <span id="display-round">1</span></div>
                <div id="guilds-display" class="guilds-display"></div>
                <div class="current-timer" style="font-size: 1.1rem; margin-top: 20px;">Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: <span id="display-timer">02:00</span></div>
              </div>
              <button id="update-display" class="btn-secondary" style="margin-top: 20px;">
                <i class="fas fa-sync-alt"></i> ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶
              </button>
            </div>
          </div>
        </div>
      </section>
    </div>
    
    <div class="footer">
      <p>ØµÙ…Ù…Øª Ø¨ÙˆØ§Ø³Ø·Ø© ğ–¤|ğ‘ğ„ğƒğ’ğ–ğğ‘ğƒğŸ‡¦ğŸ‡· | ØªÙ… Ø§Ù„ØªØ·ÙˆÙŠØ± ÙˆØ§Ù„ØªØ­Ø³ÙŠÙ† <i class="fa-solid fa-heart"></i></p>
      <p>Ù„Ø¹Ø¨Ø© ØµØ±Ø§Ø¹ Ø§Ù„Ù†Ù‚Ø§Ø¨Ø§Øª - Ø§Ù„Ø¥ØµØ¯Ø§Ø± 4.0 | Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©</p>
    </div>
  </div>

  <!-- Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø¹Ø§Ø¦Ù…Ø© -->
  <div class="floating-controls">
    <button id="save-float-btn" class="btn-secondary floating-btn">
      <i class="fa-solid fa-save"></i>
    </button>
    <button id="sound-toggle-btn" class="btn-warning floating-btn">
      <i class="fa-solid fa-volume-high"></i>
    </button>
  </div>

  <script>
    // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø©
    const decisions = [
      { value: "mission", label: "ØªÙ†ÙÙŠØ° Ù…Ù‡Ù…Ø© Ø³Ø±ÙŠØ©", icon: "fa-solid fa-user-secret", color: "#54a0ff" },
      { value: "attack", label: "Ù‡Ø¬ÙˆÙ… Ø¹Ù„Ù‰ Ù†Ù‚Ø§Ø¨Ø© Ø£Ø®Ø±Ù‰", icon: "fa-solid fa-crosshairs", color: "#ff6b6b" },
      { value: "alliance", label: "ØªØ­Ø§Ù„Ù", icon: "fa-solid fa-handshake", color: "#00b894" },
      { value: "bribe", label: "Ø±Ø´ÙˆØ© Ø§Ù„Ø­ÙƒÙ…", icon: "fa-solid fa-money-bill-wave", color: "#feca57" },
      { value: "betray", label: "Ø®ÙŠØ§Ù†Ø©", icon: "fa-solid fa-mask", color: "#6c5ce7" },
      { value: "defend", label: "Ø§Ù„Ø¯ÙØ§Ø¹", icon: "fa-solid fa-shield-alt", color: "#9b59b6" },
      { value: "diplomacy", label: "Ø¯Ø¨Ù„ÙˆÙ…Ø§Ø³ÙŠØ©", icon: "fa-solid fa-dove", color: "#1abc9c" }
    ];

    const randomEvents = [
      { 
        title: "Ù‡Ø¯ÙŠØ© Ù…Ù† Ø§Ù„Ù…Ù„Ùƒ", 
        description: "Ø§Ù„Ù…Ù„Ùƒ ÙŠÙ…Ù†Ø­ ÙƒÙ„ Ø§Ù„Ù†Ù‚Ø§Ø¨Ø§Øª Ù‡Ø¨Ø© Ù…Ø§Ù„ÙŠØ©! ÙƒÙ„ Ù†Ù‚Ø§Ø¨Ø© ØªØ±Ø¨Ø­ 2-5 Ù†Ù‚Ø§Ø·.", 
        effect: guilds => guilds.forEach(g => {
          const bonus = Math.floor(Math.random() * 4) + 2;
          g.points += bonus;
          g.pointsChange += bonus;
        }),
        icon: "fa-solid fa-crown",
        color: "#feca57"
      },
      { 
        title: "ÙƒØ§Ø±Ø«Ø© Ø·Ø¨ÙŠØ¹ÙŠØ©", 
        description: "Ø²Ù„Ø²Ø§Ù„ Ù…Ø¯Ù…Ø± ÙŠØ¶Ø±Ø¨ Ø§Ù„Ù…Ù†Ø·Ù‚Ø©! ÙƒÙ„ Ø§Ù„Ù†Ù‚Ø§Ø¨Ø§Øª ØªØ®Ø³Ø± 1-4 Ù†Ù‚Ø§Ø·.", 
        effect: guilds => guilds.forEach(g => {
          const loss = Math.floor(Math.random() * 4) + 1;
          g.points -= loss;
          g.pointsChange -= loss;
        }),
        icon: "fa-solid fa-volcano",
        color: "#ff6b6b"
      },
      { 
        title: "Ø§ÙƒØªØ´Ø§Ù Ù…Ù†Ø¬Ù…", 
        description: "Ø§ÙƒØªØ´Ø§Ù Ù…Ù†Ø¬Ù… Ø°Ù‡Ø¨ ÙÙŠ Ø£Ø±Ø§Ø¶ÙŠ Ø¥Ø­Ø¯Ù‰ Ø§Ù„Ù†Ù‚Ø§Ø¨Ø§Øª! Ø§Ù„Ù†Ù‚Ø§Ø¨Ø© ØµØ§Ø­Ø¨Ø© Ø£Ø¹Ù„Ù‰ Ù†Ù‚Ø§Ø· ØªØ±Ø¨Ø­ 5 Ù†Ù‚Ø§Ø·.", 
        effect: guilds => {
          const topGuild = [...guilds].sort((a, b) => b.points - a.points)[0];
          topGuild.points += 5;
          topGuild.pointsChange += 5;
        },
        icon: "fa-solid fa-gem",
        color: "#feca57"
      },
      { 
        title: "ÙˆØ¨Ø§Ø¡ Ù…ÙØ§Ø¬Ø¦", 
        description: "ÙˆØ¨Ø§Ø¡ Ø®Ø·ÙŠØ± ÙŠØµÙŠØ¨ Ø§Ù„Ù…Ù†Ø·Ù‚Ø©! Ø§Ù„Ù†Ù‚Ø§Ø¨Ø© ØµØ§Ø­Ø¨Ø© Ø£Ù‚Ù„ Ù†Ù‚Ø§Ø· ØªØ®Ø³Ø± 3 Ù†Ù‚Ø§Ø·.", 
        effect: guilds => {
          const bottomGuild = [...guilds].sort((a, b) => a.points - b.points)[0];
          bottomGuild.points -= 3;
          bottomGuild.pointsChange -= 3;
        },
        icon: "fa-solid fa-virus",
        color: "#ff6b6b"
      }
    ];

    let guilds = [];
    let round = 1;
    let gameStarted = false;
    let filterNegative = false;
    let betrayers = {};
    let totalPlayers = 0;
    let timerInterval;
    let timeLeft = 120; // 2 Ø¯Ù‚ÙŠÙ‚Ø©
    let soundEnabled = true;

    // Ø¹Ù†Ø§ØµØ± ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    const guildsInputsDiv = document.getElementById('guilds-inputs');
    const setupSection = document.getElementById('setup-section');
    const gameSection = document.getElementById('game-section');
    const guildsTableBody = document.getElementById('guilds-table-body');
    const scoresTableBody = document.getElementById('scores-table-body');
    const roundNumberSpan = document.getElementById('round-number');
    const currentRoundSpan = document.getElementById('current-round');
    const roundSummaryDiv = document.getElementById('round-summary');
    const nextRoundBtn = document.getElementById('next-round-btn');
    const submitDecisionsBtn = document.getElementById('submit-decisions-btn');
    const resetGameBtn = document.getElementById('reset-game-btn');
    const startGameBtn = document.getElementById('start-game-btn');
    const filterScoresBtn = document.getElementById('filter-scores-btn');
    const randomEventDiv = document.getElementById('random-event');
    const eventDescriptionDiv = document.getElementById('event-description');
    const totalGuildsSpan = document.getElementById('total-guilds');
    const totalPlayersSpan = document.getElementById('total-players');
    const guildsCountSelect = document.getElementById('guilds-count');
    const saveGameBtn = document.getElementById('save-game-btn');
    const loadGameBtn = document.getElementById('load-game-btn');
    const saveFloatBtn = document.getElementById('save-float-btn');
    const soundToggleBtn = document.getElementById('sound-toggle-btn');
    
    // Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…Ø¤Ù‚Øª
    const timerDisplay = document.getElementById('timer-display');
    const startTimerBtn = document.getElementById('start-timer');
    const pauseTimerBtn = document.getElementById('pause-timer');
    const resetTimerBtn = document.getElementById('reset-timer');
    
    // Ø¹Ù†Ø§ØµØ± Ø´Ø§Ø´Ø© Ø§Ù„Ø¹Ø±Ø¶
    const displayView = document.getElementById('display-view');
    const displayRound = document.getElementById('display-round');
    const displayTimer = document.getElementById('display-timer');
    const guildsDisplay = document.getElementById('guilds-display');
    const updateDisplayBtn = document.getElementById('update-display');
    const announcementBar = document.getElementById('announcement');
    const guildStatsDiv = document.getElementById('guild-stats');

    // Ø¥Ù†Ø´Ø§Ø¡ Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ù„Ù„Ù†Ù‚Ø§Ø¨Ø§Øª Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø®ØªØ§Ø±
    function createGuildInputs(count) {
      guildsInputsDiv.innerHTML = '';
      
      for (let i = 0; i < count; i++) {
        const div = document.createElement('div');
        div.className = 'guild-card fade-in';
        div.innerHTML = `
          <h4>Ø§Ù„Ù†Ù‚Ø§Ø¨Ø© ${i + 1} <span class="guild-badge guild-${(i % 5) + 1}"></span></h4>
          <label>Ø§Ø³Ù… Ø§Ù„Ù†Ù‚Ø§Ø¨Ø©:</label>
          <input type="text" class="guild-name" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù†Ù‚Ø§Ø¨Ø©" required />
          <div class="validation-error" id="name-error-${i}">ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù†Ù‚Ø§Ø¨Ø©</div>
          <label>Ø¹Ø¯Ø¯ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†:</label>
          <input type="number" min="1" max="20" value="3" class="guild-players" required />
          <div class="validation-error" id="players-error-${i}">ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¹Ø¯Ø¯ ØµØ­ÙŠØ­ Ø¨ÙŠÙ† 1 Ùˆ 20</div>
        `;
        guildsInputsDiv.appendChild(div);

        const nameInput = div.querySelector('.guild-name');
        const playersInput = div.querySelector('.guild-players');
        const nameError = div.querySelector(`#name-error-${i}`);
        const playersError = div.querySelector(`#players-error-${i}`);
        
        nameInput.addEventListener('input', validateForm);
        playersInput.addEventListener('input', validateForm);
      }
      
      validateForm();
    }

    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
    function validateForm() {
      let isValid = true;
      const guildCards = guildsInputsDiv.querySelectorAll('.guild-card');
      
      if (guildCards.length === 0) {
        startGameBtn.disabled = true;
        return false;
      }
      
      guildCards.forEach((card, index) => {
        const nameInput = card.querySelector('.guild-name');
        const playersInput = card.querySelector('.guild-players');
        const nameError = card.querySelector(`#name-error-${index}`);
        const playersError = card.querySelector(`#players-error-${index}`);
        
        if (nameInput && nameInput.value.trim() === '') {
          if (nameError) nameError.style.display = 'block';
          isValid = false;
        } else {
          if (nameError) nameError.style.display = 'none';
        }
        
        if (playersInput) {
          const players = parseInt(playersInput.value);
          if (isNaN(players) || players < 1 || players > 20) {
            if (playersError) playersError.style.display = 'block';
            isValid = false;
          } else {
            if (playersError) playersError.style.display = 'none';
          }
        } else {
          isValid = false;
        }
      });
      
      startGameBtn.disabled = !isValid;
      return isValid;
    }

    // ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù†Ù‚Ø§Ø¨Ø§Øª
    function updateGuildsTable() {
      guildsTableBody.innerHTML = '';
      guilds.forEach((g, idx) => {
        const tr = document.createElement('tr');
        tr.className = 'fade-in';
        tr.innerHTML = `
          <td>
            <span class="guild-badge guild-${(idx % 5) + 1}"></span>
            ${g.name}
          </td>
          <td>${g.players}</td>
          <td class="points">${g.points}</td>
          <td class="actions">
            <select class="action-select" id="decision-select-${idx}">
              <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø±Ø§Ø± --</option>
              ${decisions.map(d => 
                `<option value="${d.value}" ${g.decision === d.value ? 'selected' : ''}>
                  ${d.label}
                </option>`
              ).join('')}
            </select>
          </td>
          <td class="actions">
            <select class="target-select" id="target-select-${idx}" ${g.decision === 'attack' || g.decision === 'alliance' ? '' : 'disabled'}>
              <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù‡Ø¯Ù --</option>
              ${guilds.filter((_, i) => i !== idx).map(target => 
                `<option value="${target.name}" ${g.target === target.name ? 'selected' : ''}>
                  ${target.name}
                </option>`
              ).join('')}
            </select>
          </td>
        `;
        guildsTableBody.appendChild(tr);
        
        const decisionSelect = document.getElementById(`decision-select-${idx}`);
        const targetSelect = document.getElementById(`target-select-${idx}`);
        
        if(decisionSelect) {
          decisionSelect.addEventListener('change', function() {
            g.decision = this.value;
            if(targetSelect) {
              targetSelect.disabled = !(this.value === 'attack' || this.value === 'alliance');
              if (this.value !== 'attack' && this.value !== 'alliance') {
                g.target = null;
                targetSelect.value = '';
              }
            }
          });
        }
        
        if(targetSelect) {
          targetSelect.addEventListener('change', function() {
            g.target = this.value;
          });
        }
      });
    }

    // ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù†Ù‚Ø§Ø·
    function updateScoresTable() {
      scoresTableBody.innerHTML = '';
      
      const sortedGuilds = [...guilds].sort((a, b) => b.points - a.points);
      
      sortedGuilds.forEach((g, index) => {
        const guildIndex = guilds.findIndex(gg => gg.name === g.name);
        const tr = document.createElement('tr');
        tr.className = 'fade-in';
        
        let pointsChangeDisplay = '';
        if (g.pointsChange > 0) {
          pointsChangeDisplay = `<span class="points positive">+${g.pointsChange}</span>`;
        } else if (g.pointsChange < 0) {
          pointsChangeDisplay = `<span class="points negative">${g.pointsChange}</span>`;
        }
        
        let lastActionDisplay = '';
        if (g.lastAction) {
          const decision = decisions.find(d => d.value === g.lastAction);
          if (decision) {
            lastActionDisplay = `
              <i class="${decision.icon}" style="color: ${decision.color}"></i>
              ${decision.label}
            `;
          }
        }
        
        tr.innerHTML = `
          <td>
            <span class="guild-badge guild-${(guildIndex % 5) + 1}"></span>
            ${g.name}
            ${index === 0 && g.points > 0 ? '<span class="winner-badge">Ø§Ù„Ø±Ø§Ø¨Ø­</span>' : ''}
          </td>
          <td class="points">${g.points}</td>
          <td>${pointsChangeDisplay}</td>
          <td>${lastActionDisplay}</td>
        `;
        scoresTableBody.appendChild(tr);
      });
    }

    // ØªØ­Ø¯ÙŠØ« Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù†Ù‚Ø§Ø¨Ø§Øª
    function updateGuildStats() {
      guildStatsDiv.innerHTML = '';
      
      guilds.forEach((guild, index) => {
        const statDiv = document.createElement('div');
        statDiv.className = 'stat-item fade-in';
        statDiv.innerHTML = `
          <div class="guild-display-name">
            <span class="guild-badge guild-${(index % 5) + 1}"></span>
            ${guild.name}
          </div>
          <div class="stat-value">${guild.points}</div>
          <div class="stat-label">Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø­Ø§Ù„ÙŠØ©</div>
          <div class="stat-value">${guild.players}</div>
          <div class="stat-label">Ø¹Ø¯Ø¯ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†</div>
        `;
        guildStatsDiv.appendChild(statDiv);
      });
    }

    // Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©
    function startGame() {
      if (!validateForm()) {
        announcement('ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ù‚Ø§Ø¨Ø§Øª Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­');
        return;
      }
      
      guilds = [];
      const guildCards = guildsInputsDiv.querySelectorAll('.guild-card');
      
      totalPlayers = 0;
      
      guildCards.forEach((card, index) => {
        const nameInput = card.querySelector('.guild-name');
        const playersInput = card.querySelector('.guild-players');
        
        const name = nameInput.value.trim();
        const players = parseInt(playersInput.value) || 3;
        totalPlayers += players;
        
        guilds.push({ 
          name, 
          players, 
          points: 0, 
          decision: null, 
          target: null,
          lastAction: "",
          pointsChange: 0,
          betrayPenalty: false
        });
      });
      
      round = 1;
      roundNumberSpan.textContent = round;
      currentRoundSpan.textContent = round;
      displayRound.textContent = round;
      totalGuildsSpan.textContent = guilds.length;
      totalPlayersSpan.textContent = totalPlayers;
      setupSection.classList.add('hidden');
      gameSection.classList.remove('hidden');
      updateGuildsTable();
      updateScoresTable();
      updateGuildStats();
      roundSummaryDiv.innerHTML = "<p>ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù‚Ø±Ø§Ø±Ø§Øª Ø§Ù„Ù†Ù‚Ø§Ø¨Ø§Øª ÙˆØ§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ 'ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù‚Ø±Ø§Ø±Ø§Øª'.</p>";
      nextRoundBtn.classList.add('hidden');
      submitDecisionsBtn.style.display = 'flex';
      randomEventDiv.classList.add('hidden');
      gameStarted = true;
      
      betrayers = {};
      resetTimer();
      saveGameState();
      
      // Ø¥Ø¹Ù„Ø§Ù† Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©
      announcement("Ø¨Ø¯Ø£Øª Ø§Ù„Ù„Ø¹Ø¨Ø©! Ø§Ù„Ø¬ÙˆÙ„Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ Ø¬Ø§Ù‡Ø²Ø©.");
    }

    // Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø¤Ù‚Øª
    function updateTimerDisplay() {
      const minutes = Math.floor(timeLeft / 60);
      const seconds = timeLeft % 60;
      timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
      displayTimer.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
    }

    function startTimer() {
      clearInterval(timerInterval);
      timerInterval = setInterval(() => {
        timeLeft--;
        updateTimerDisplay();
        
        if (timeLeft <= 0) {
          clearInterval(timerInterval);
          announcement("Ø§Ù†ØªÙ‡Ù‰ ÙˆÙ‚Øª Ø§Ù„Ø¬ÙˆÙ„Ø©! Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§ØªØ®Ø§Ø° Ø§Ù„Ù‚Ø±Ø§Ø±Ø§Øª Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©.");
          if (soundEnabled) playSound('end');
        }
      }, 1000);
      
      announcement("Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø¤Ù‚Øª! Ù„Ø¯ÙŠÙƒ Ø¯Ù‚ÙŠÙ‚ØªØ§Ù† Ù„Ø§ØªØ®Ø§Ø° Ø§Ù„Ù‚Ø±Ø§Ø±.");
      if (soundEnabled) playSound('start');
    }

    function pauseTimer() {
      clearInterval(timerInterval);
      announcement("ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø¤Ù‚Øª Ù…Ø¤Ù‚ØªÙ‹Ø§.");
    }

    function resetTimer() {
      clearInterval(timerInterval);
      timeLeft = 120;
      updateTimerDisplay();
      announcement("ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…Ø¤Ù‚Øª.");
    }

    // Ø´Ø§Ø´Ø© Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¨Ø³Ø·Ø©
    function updateDisplay() {
      displayRound.textContent = round;
      guildsDisplay.innerHTML = '';
      
      guilds.forEach((guild, index) => {
        const guildCard = document.createElement('div');
        guildCard.className = 'guild-display-card fade-in';
        guildCard.innerHTML = `
          <div class="guild-display-name">
            <span class="guild-badge guild-${(index % 5) + 1}"></span>
            ${guild.name}
          </div>
          <div class="guild-display-points">${guild.points}</div>
          <div>${guild.players} Ù„Ø§Ø¹Ø¨ÙŠÙ†</div>
        `;
        guildsDisplay.appendChild(guildCard);
      });
      
      announcement("ØªÙ… ØªØ­Ø¯ÙŠØ« Ø´Ø§Ø´Ø© Ø§Ù„Ø¹Ø±Ø¶ Ù„Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ†");
    }

    // Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
    function announcement(message) {
      announcementBar.textContent = message;
      announcementBar.classList.remove('hidden');
      
      // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø¨Ø¹Ø¯ 5 Ø«ÙˆØ§Ù†
      setTimeout(() => {
        announcementBar.classList.add('hidden');
      }, 5000);
      
      // Ø§Ø³ØªØ®Ø¯Ø§Ù… Web Speech API Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ØªÙˆÙØ±Ø© ÙˆØ§Ù„ØµÙˆØª Ù…ÙØ¹Ù„
      if (soundEnabled && 'speechSynthesis' in window) {
        const speech = new SpeechSynthesisUtterance();
        speech.text = message;
        speech.lang = 'ar-SA';
        speech.volume = 1;
        speech.rate = 1;
        speech.pitch = 1;
        
        window.speechSynthesis.speak(speech);
      }
    }

    // ØªØ£Ø«ÙŠØ±Ø§Øª ØµÙˆØªÙŠØ© (Ø¨Ø¯Ø§Ø¦Ù„ Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ø§Ù„Ù…Ù„ÙØ§Øª Ù…ØªÙˆÙØ±Ø©)
    function playSound(soundType) {
      // Ù‡Ø°Ù‡ Ø¨Ø¯Ø§Ø¦Ù„ ØµÙˆØªÙŠØ© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†ØºÙ…Ø§Øª Ø¨Ø³ÙŠØ·Ø©
      try {
        const context = new (window.AudioContext || window.webkitAudioContext)();
        const oscillator = context.createOscillator();
        const gainNode = context.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(context.destination);
        
        switch(soundType) {
          case 'start':
            oscillator.frequency.setValueAtTime(523.25, context.currentTime); // C5
            break;
          case 'decision':
            oscillator.frequency.setValueAtTime(659.25, context.currentTime); // E5
            break;
          case 'result':
            oscillator.frequency.setValueAtTime(783.99, context.currentTime); // G5
            break;
          case 'event':
            oscillator.frequency.setValueAtTime(392.00, context.currentTime); // G4
            break;
          case 'end':
            oscillator.frequency.setValueAtTime(261.63, context.currentTime); // C4
            break;
        }
        
        gainNode.gain.setValueAtTime(0.3, context.currentTime);
        oscillator.start();
        
        setTimeout(() => {
          oscillator.stop();
        }, 500);
      } catch (e) {
        console.log("ØªØ¹Ø°Ø± ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª:", e);
      }
    }

    // Ø­Ø³Ø§Ø¨ Ù†Ù‚Ø§Ø· Ø§Ù„Ù‚Ø±Ø§Ø±
    function calculateDecisionPoints(guild, decisionType) {
      const baseFactor = Math.floor(guild.players * 0.5);
      const roundFactor = Math.min(round * 0.2, 1.5);
      const randomFactor = 0.8 + Math.random() * 0.4;
      
      let basePoints = 0;
      
      switch(decisionType) {
        case 'mission': basePoints = 3 + Math.floor(Math.random() * 3); break;
        case 'attack': basePoints = 2 + Math.floor(Math.random() * 2); break;
        case 'alliance': basePoints = 1 + Math.floor(Math.random() * 2); break;
        case 'bribe': basePoints = 2 + Math.floor(Math.random() * 2); break;
        case 'betray': basePoints = 4 + Math.floor(Math.random() * 3); break;
        case 'defend': basePoints = 1 + Math.floor(Math.random() * 2); break;
        case 'diplomacy': basePoints = 1 + Math.floor(Math.random() * 3); break;
      }
      
      return Math.max(1, Math.floor(basePoints * baseFactor * roundFactor * randomFactor));
    }

    // Ø­Ø³Ø§Ø¨ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¬ÙˆÙ„Ø©
    function calculateResults() {
      guilds.forEach((g, idx) => {
        const selectEl = document.getElementById(`decision-select-${idx}`);
        if (selectEl) {
          g.decision = selectEl.value;
          g.lastAction = g.decision;
          g.pointsChange = 0;
          
          if ((g.decision === 'attack' || g.decision === 'alliance') && !g.target) {
            const targetSelect = document.getElementById(`target-select-${idx}`);
            if (targetSelect && targetSelect.options.length > 1) {
              targetSelect.selectedIndex = 1;
              g.target = targetSelect.options[1].value;
            }
          }
        }
      });

      let allDecisionsValid = true;
      guilds.forEach(g => {
        if (!g.decision || ((g.decision === 'attack' || g.decision === 'alliance') && !g.target)) {
          allDecisionsValid = false;
        }
      });

      if (!allDecisionsValid) {
        announcement('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù‚Ø±Ø§Ø±Ø§Øª ØµØ­ÙŠØ­Ø© Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù†Ù‚Ø§Ø¨Ø§Øª!\n- Ø§Ø®ØªØ± Ù‚Ø±Ø§Ø±Ù‹Ø§ Ù„ÙƒÙ„ Ù†Ù‚Ø§Ø¨Ø©\n- Ø¥Ø°Ø§ Ø§Ø®ØªØ±Øª "Ù‡Ø¬ÙˆÙ…" Ø£Ùˆ "ØªØ­Ø§Ù„Ù" ÙŠØ¬Ø¨ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù‡Ø¯Ù');
        return;
      }

      let summary = `<h3>Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¬ÙˆÙ„Ø© ${round}:</h3><ul>`;
      
      guilds.forEach(g => {
        if (betrayers[g.name]) {
          const penalty = Math.floor(Math.random() * 3) + 2;
          g.points -= penalty;
          g.pointsChange -= penalty;
          summary += `<li>Ù†Ù‚Ø§Ø¨Ø© <strong>${g.name}</strong> Ø®Ø³Ø±Øª <span class="points negative">${penalty} Ù†Ù‚Ø§Ø·</span> Ø¨Ø³Ø¨Ø¨ Ø¹Ù‚ÙˆØ¨Ø© Ø§Ù„Ø®ÙŠØ§Ù†Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©.</li>`;
          betrayers[g.name] = false;
        }
      });

      guilds.forEach(g => {
        switch(g.decision) {
          case 'mission':
            const missionPoints = calculateDecisionPoints(g, 'mission');
            g.points += missionPoints;
            g.pointsChange += missionPoints;
            summary += `<li>Ù†Ù‚Ø§Ø¨Ø© <strong>${g.name}</strong> Ù†ÙØ°Øª Ù…Ù‡Ù…Ø© Ø³Ø±ÙŠØ© ÙˆØ±Ø¨Ø­Øª <span class="points positive">${missionPoints} Ù†Ù‚Ø§Ø·</span>.</li>`;
            break;
            
          case 'attack':
            const targetGuild = guilds.find(t => t.name === g.target);
            if (targetGuild) {
              const attackPoints = Math.max(1, Math.floor((2 + Math.floor(Math.random() * 3)) * (g.players / targetGuild.players) * (0.7 + Math.random() * 0.6)));
              targetGuild.points -= attackPoints;
              targetGuild.pointsChange -= attackPoints;
              g.points += Math.floor(attackPoints * 0.7);
              g.pointsChange += Math.floor(attackPoints * 0.7);
              summary += `<li>Ù†Ù‚Ø§Ø¨Ø© <strong>${g.name}</strong> Ù‡Ø§Ø¬Ù…Øª Ù†Ù‚Ø§Ø¨Ø© <strong>${g.target}</strong>ØŒ Ø®ØµÙ…ØªÙ‡Ø§ <span class="points negative">${attackPoints} Ù†Ù‚Ø§Ø·</span> ÙˆØ±Ø¨Ø­Øª <span class="points positive">${Math.floor(attackPoints * 0.7)} Ù†Ù‚Ø§Ø·</span>.</li>`;
            }
            break;
            
          case 'alliance':
            const allianceGuild = guilds.find(t => t.name === g.target);
            if (allianceGuild) {
              const alliancePoints = calculateDecisionPoints(g, 'alliance');
              g.points += alliancePoints;
              g.pointsChange += alliancePoints;
              allianceGuild.points += Math.floor(alliancePoints * 0.8);
              allianceGuild.pointsChange += Math.floor(alliancePoints * 0.8);
              summary += `<li>Ù†Ù‚Ø§Ø¨Ø© <strong>${g.name}</strong> Ø¹Ù‚Ø¯Øª ØªØ­Ø§Ù„ÙÙ‹Ø§ Ù…Ø¹ <strong>${g.target}</strong>ØŒ Ø±Ø¨Ø­Øª <span class="points positive">${alliancePoints} Ù†Ù‚Ø§Ø·</span> ÙˆØ±Ø¨Ø­Øª Ø§Ù„Ù†Ù‚Ø§Ø¨Ø© Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ© <span class="points positive">${Math.floor(alliancePoints * 0.8)} Ù†Ù‚Ø§Ø·</span>.</li>`;
            }
            break;
            
          case 'bribe':
            const bribePoints = calculateDecisionPoints(g, 'bribe');
            g.points += bribePoints;
            g.pointsChange += bribePoints;
            summary += `<li>Ù†Ù‚Ø§Ø¨Ø© <strong>${g.name}</strong> Ø±Ø´Øª Ø§Ù„Ø­ÙƒÙ… ÙˆØ±Ø¨Ø­Øª <span class="points positive">${bribePoints} Ù†Ù‚Ø§Ø·</span>.</li>`;
            break;
            
          case 'betray':
            const betrayPoints = calculateDecisionPoints(g, 'betray');
            g.points += betrayPoints;
            g.pointsChange += betrayPoints;
            betrayers[g.name] = true;
            summary += `<li>Ù†Ù‚Ø§Ø¨Ø© <strong>${g.name}</strong> Ø®Ø§Ù†Øª Ø§Ù„Ù†Ù‚Ø§Ø¨Ø§Øª ÙˆØ±Ø¨Ø­Øª <span class="points positive">${betrayPoints} Ù†Ù‚Ø§Ø·</span>ØŒ Ù„ÙƒÙ†Ù‡Ø§ Ø³ØªØ®Ø³Ø± Ù†Ù‚Ø§Ø· ÙÙŠ Ø§Ù„Ø¬ÙˆÙ„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©.</li>`;
            break;
            
          case 'defend':
            const defensePoints = calculateDecisionPoints(g, 'defend');
            g.points += defensePoints;
            g.pointsChange += defensePoints;
            summary += `<li>Ù†Ù‚Ø§Ø¨Ø© <strong>${g.name}</strong> Ø¹Ø²Ø²Øª Ø¯ÙØ§Ø¹Ø§ØªÙ‡Ø§ ÙˆØ±Ø¨Ø­Øª <span class="points positive">${defensePoints} Ù†Ù‚Ø§Ø·</span>.</li>`;
            break;
            
          case 'diplomacy':
            const diplomacyPoints = calculateDecisionPoints(g, 'diplomacy');
            g.points += diplomacyPoints;
            g.pointsChange += diplomacyPoints;
            summary += `<li>Ù†Ù‚Ø§Ø¨Ø© <strong>${g.name}</strong> Ù†ÙØ°Øª Ø¬Ù‡ÙˆØ¯Ù‹Ø§ Ø¯Ø¨Ù„ÙˆÙ…Ø§Ø³ÙŠØ© ÙˆØ±Ø¨Ø­Øª <span class="points positive">${diplomacyPoints} Ù†Ù‚Ø§Ø·</span>.</li>`;
            break;
        }
      });

      guilds.forEach(g => {
        if (g.points < 0) g.points = 0;
      });

      summary += "</ul>";
      roundSummaryDiv.innerHTML = summary;

      // Ø­Ø¯Ø« Ø¹Ø´ÙˆØ§Ø¦ÙŠ
      if (round > 1 && Math.random() > 0.4) {
        const event = randomEvents[Math.floor(Math.random() * randomEvents.length)];
        event.effect(guilds);
        
        randomEventDiv.classList.remove('hidden');
        eventDescriptionDiv.innerHTML = `
          <div class="event-title" style="color: ${event.color}">
            <i class="${event.icon}"></i>
            ${event.title}
          </div>
          <p>${event.description}</p>
        `;
        
        roundSummaryDiv.innerHTML += `
          <div class="event-card">
            <div class="event-title" style="color: ${event.color}">
              <i class="${event.icon}"></i>
              ${event.title}
            </div>
            <p>${event.description}</p>
          </div>
        `;
        
        announcement(`Ø­Ø¯Ø« Ù…ÙØ§Ø¬Ø¦: ${event.title}! ${event.description}`);
        if (soundEnabled) playSound('event');
      }

      updateScoresTable();
      updateGuildStats();
      updateDisplay();
      submitDecisionsBtn.style.display = 'none';
      nextRoundBtn.classList.remove('hidden');
      pauseTimer();
      saveGameState();
      
      announcement("ØªÙ… Ø­Ø³Ø§Ø¨ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¬ÙˆÙ„Ø©! Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬.");
      if (soundEnabled) playSound('result');
    }

    // Ø¬ÙˆÙ„Ø© Ø¬Ø¯ÙŠØ¯Ø©
    function nextRound() {
      round++;
      roundNumberSpan.textContent = round;
      currentRoundSpan.textContent = round;
      displayRound.textContent = round;
      
      guilds.forEach(g => {
        g.decision = null;
        g.target = null;
        g.pointsChange = 0;
      });
      
      updateGuildsTable();
      roundSummaryDiv.innerHTML = "<p>ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù‚Ø±Ø§Ø±Ø§Øª Ø§Ù„Ù†Ù‚Ø§Ø¨Ø§Øª ÙˆØ§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ 'ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù‚Ø±Ø§Ø±Ø§Øª'.</p>";
      nextRoundBtn.classList.add('hidden');
      submitDecisionsBtn.style.display = 'flex';
      randomEventDiv.classList.add('hidden');
      resetTimer();
      updateDisplay();
      saveGameState();
      
      announcement(`Ø¨Ø¯Ø£Øª Ø§Ù„Ø¬ÙˆÙ„Ø© ${round}! Ù„Ø¯ÙŠÙƒÙ… Ø¯Ù‚ÙŠÙ‚ØªØ§Ù† Ù„Ø§ØªØ®Ø§Ø° Ø§Ù„Ù‚Ø±Ø§Ø±Ø§Øª.`);
      if (soundEnabled) playSound('start');
    }

    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù„Ø¹Ø¨Ø©
    function resetGame() {
      if(confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ù‚Ù‹Ø§ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù„Ø¹Ø¨Ø©ØŸ Ø³ÙŠØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù†Ù‚Ø§Ø· ÙˆØ§Ù„Ø¨ÙŠØ§Ù†Ø§Øª!")) {
        guilds = [];
        round = 1;
        betrayers = {};
        setupSection.classList.remove('hidden');
        gameSection.classList.add('hidden');
        roundSummaryDiv.innerHTML = '';
        guildsCountSelect.value = '';
        guildsInputsDiv.innerHTML = '';
        startGameBtn.disabled = true;
        clearInterval(timerInterval);
        localStorage.removeItem('guildConflictGame');
      }
    }

    // ØªØµÙÙŠØ© Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø³Ù„Ø¨ÙŠØ©
    function filterNegativeScores() {
      filterNegative = !filterNegative;
      filterScoresBtn.innerHTML = filterNegative ? 
        '<i class="fa-solid fa-filter-circle-xmark"></i> Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØµÙÙŠØ©' : 
        '<i class="fa-solid fa-filter"></i> ØªØµÙÙŠØ© Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø³Ù„Ø¨ÙŠØ©';
      
      guilds.forEach(g => {
        if (filterNegative && g.points < 0) {
          g.points = 0;
        }
      });
      
      updateScoresTable();
      updateGuildStats();
      updateDisplay();
      saveGameState();
    }

    // Ø­ÙØ¸ Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
    function saveGameState() {
      const gameState = {
        guilds,
        round,
        betrayers,
        totalPlayers,
        filterNegative,
        timeLeft
      };
      localStorage.setItem('guildConflictGame', JSON.stringify(gameState));
      announcement("ØªÙ… Ø­ÙØ¸ Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© Ø¨Ù†Ø¬Ø§Ø­!");
    }

    // Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
    function loadGameState() {
      const savedGame = localStorage.getItem('guildConflictGame');
      if (savedGame) {
        const gameState = JSON.parse(savedGame);
        guilds = gameState.guilds;
        round = gameState.round;
        betrayers = gameState.betrayers;
        totalPlayers = gameState.totalPlayers;
        filterNegative = gameState.filterNegative;
        timeLeft = gameState.timeLeft || 120;
        
        roundNumberSpan.textContent = round;
        currentRoundSpan.textContent = round;
        displayRound.textContent = round;
        totalGuildsSpan.textContent = guilds.length;
        totalPlayersSpan.textContent = totalPlayers;
        setupSection.classList.add('hidden');
        gameSection.classList.remove('hidden');
        updateGuildsTable();
        updateScoresTable();
        updateGuildStats();
        updateDisplay();
        updateTimerDisplay();
        
        if (gameState.timeLeft > 0) {
          roundSummaryDiv.innerHTML = "<p>ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©. ÙŠÙ…ÙƒÙ†Ùƒ Ù…ØªØ§Ø¨Ø¹Ø© Ù…Ù† Ø­ÙŠØ« ØªÙˆÙ‚ÙØª.</p>";
        } else {
          roundSummaryDiv.innerHTML = "<p>ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù‚Ø±Ø§Ø±Ø§Øª Ø§Ù„Ù†Ù‚Ø§Ø¨Ø§Øª ÙˆØ§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ 'ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù‚Ø±Ø§Ø±Ø§Øª'.</p>";
        }
        
        nextRoundBtn.classList.add('hidden');
        submitDecisionsBtn.style.display = 'flex';
        randomEventDiv.classList.add('hidden');
        gameStarted = true;
        
        announcement("ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© Ø¨Ù†Ø¬Ø§Ø­!");
      } else {
        announcement("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù„Ø¹Ø¨Ø© Ù…Ø­ÙÙˆØ¸Ø©!");
      }
    }

    // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ØµÙˆØª
    function toggleSound() {
      soundEnabled = !soundEnabled;
      soundToggleBtn.innerHTML = soundEnabled ? 
        '<i class="fa-solid fa-volume-high"></i>' : 
        '<i class="fa-solid fa-volume-xmark"></i>';
      announcement(soundEnabled ? "ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª" : "ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØµÙˆØª");
    }

    // Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
    startGameBtn.addEventListener('click', startGame);
    submitDecisionsBtn.addEventListener('click', calculateResults);
    nextRoundBtn.addEventListener('click', nextRound);
    resetGameBtn.addEventListener('click', resetGame);
    filterScoresBtn.addEventListener('click', filterNegativeScores);
    saveGameBtn.addEventListener('click', saveGameState);
    loadGameBtn.addEventListener('click', loadGameState);
    saveFloatBtn.addEventListener('click', saveGameState);
    soundToggleBtn.addEventListener('click', toggleSound);
    
    // Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù…Ø¤Ù‚Øª
    startTimerBtn.addEventListener('click', startTimer);
    pauseTimerBtn.addEventListener('click', pauseTimer);
    resetTimerBtn.addEventListener('click', resetTimer);
    updateDisplayBtn.addEventListener('click', updateDisplay);
    
    // Ø­Ø¯Ø« Ø§Ø®ØªÙŠØ§Ø± Ø¹Ø¯Ø¯ Ø§Ù„Ù†Ù‚Ø§Ø¨Ø§Øª
    guildsCountSelect.addEventListener('change', function() {
      const count = parseInt(this.value);
      if (count >= 2 && count <= 5) {
        createGuildInputs(count);
      }
    });

    // Ø§Ù„ØªØ­Ø¶ÙŠØ± Ø§Ù„Ø£ÙˆÙ„ÙŠ
    startGameBtn.disabled = true;
    updateTimerDisplay();
    
    // Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ­Ù…ÙŠÙ„ Ù„Ø¹Ø¨Ø© Ù…Ø­ÙÙˆØ¸Ø©
    window.addEventListener('load', () => {
      if (localStorage.getItem('guildConflictGame')) {
        if (confirm("ÙŠÙˆØ¬Ø¯ Ù„Ø¹Ø¨Ø© Ù…Ø­ÙÙˆØ¸Ø©. Ù‡Ù„ ØªØ±ØºØ¨ ÙÙŠ Ø§Ø³ØªØ¹Ø§Ø¯ØªÙ‡Ø§ØŸ")) {
          loadGameState();
        }
      }
    });
  </script>
</body>
</html>